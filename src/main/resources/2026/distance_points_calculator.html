<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../../../styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—á–∫–æ–≤ –∑–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é</title>
    <style>
        body {
            margin: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input,
        select,
        output {
            padding: 8px;
            font-size: 16px;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>

<body>
    <a href="index.html">‚Üê –í—Å–µ —Å—Ç–∞—Ä—Ç—ã</a>
    <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—á–∫–æ–≤ –∑–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é</h1>
    <p style="max-width: 600px; width: 100%;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ—á–∫–∏ –∑–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞
        –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ –≤–∞—à–µ–º –≤—Ä–µ–º–µ–Ω–∏
        —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É–Ω–∫—Ç–∞ 14.7
        <a href="https://triatlon.by/assets/images/files/federation/polozhenie-lyubitelskaya-liga-2026-podpisano.pdf"
            target="_blank" rel="noopener noreferrer">–ü–æ–ª–æ–∂–µ–Ω–∏—è</a>
        –æ –õ—é–±–∏—Ç–µ–ª—å—Å–∫–æ–π –õ–∏–≥–µ:
        <img src="img/distance_points_formula.png" alt="–ü—É–Ω–∫—Ç 14.7 –ü–æ–ª–æ–∂–µ–Ω–∏—è"
            style="max-width: 400px; width: 100%; height: auto;">
    </p>
    <form id="calculator-form">
        <div class="form-group">
            <label for="event-type">–î–∏—Å—Ç–∞–Ω—Ü–∏—è:</label>
            <select id="event-type">
                <option value="–ü–æ–ª–Ω–∞—è">–ü–æ–ª–Ω–∞—è 3.8–∫–º üèä‚Äç‚ôÇÔ∏è + 180–∫–º üö¥‚Äç‚ôÇÔ∏è + 42.2–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–ü–æ–ª–æ–≤–∏–Ω–∫–∞">–ü–æ–ª–æ–≤–∏–Ω–∫–∞ 1.9–∫–º üèä‚Äç‚ôÇÔ∏è + 90–∫–º üö¥‚Äç‚ôÇÔ∏è + 21.1–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–û–ª–∏–º–ø–∏–π–∫–∞">–û–ª–∏–º–ø–∏–π–∫–∞ 1.5–∫–º üèä‚Äç‚ôÇÔ∏è + 40–∫–º üö¥‚Äç‚ôÇÔ∏è + 10–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–°–ø—Ä–∏–Ω—Ç">–°–ø—Ä–∏–Ω—Ç 750–º üèä‚Äç‚ôÇÔ∏è + 20–∫–º üö¥‚Äç‚ôÇÔ∏è + 5–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–î—É–∞—Ç–ª–æ–Ω">–î—É–∞—Ç–ª–æ–Ω 5–∫–º üèÉ‚Äç‚ôÇÔ∏è + 20–∫–º üö¥‚Äç‚ôÇÔ∏è + 2.5–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–ê–∫–≤–∞—Ç–ª–æ–Ω">–ê–∫–≤–∞—Ç–ª–æ–Ω 1–∫–º üèä‚Äç‚ôÇÔ∏è + 5–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
                <option value="–ö—Ä–æ—Å—Å">–ö—Ä–æ—Å—Å üå≤</option>
                <option value="–ò–Ω–¥–æ—Ä">–ò–Ω–¥–æ—Ä 300–º üèä‚Äç‚ôÇÔ∏è + 8–∫–º üö¥‚Äç‚ôÇÔ∏è + 2–∫–º üèÉ‚Äç‚ôÇÔ∏è</option>
            </select>
        </div>
        <div class="form-group">
            <label for="time1-hours">–í—Ä–µ–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:</label>
            <div>
                <input type="number" id="time1-hours" placeholder="—á–∞—Å—ã" min="0" max="23" value="9"
                    style="width: 60px;">
                <span>—á–∞—Å(–æ–≤), </span>
                <input type="number" id="time1-minutes" placeholder="–º–∏–Ω." min="0" max="59" value="30"
                    style="width: 60px;">
                <span>–º–∏–Ω. </span>
                <input type="number" id="time1-seconds" placeholder="—Å–µ–∫." min="0" max="59" value="0"
                    style="width: 60px;">
                <span>—Å–µ–∫.</span>
            </div>
        </div>
        <div class="form-group">
            <label for="time2-hours">–í–∞—à–µ –≤—Ä–µ–º—è:</label>
            <div>
                <input type="number" id="time2-hours" placeholder="—á–∞—Å—ã" min="0" max="23" style="width: 60px;">
                <span>—á–∞—Å(–æ–≤), </span>
                <input type="number" id="time2-minutes" placeholder="–º–∏–Ω." min="0" max="59" style="width: 60px;">
                <span>–º–∏–Ω. </span>
                <input type="number" id="time2-seconds" placeholder="—Å–µ–∫." min="0" max="59" style="width: 60px;">
                <span>—Å–µ–∫.</span>
            </div>
        </div>
        <div class="form-group">
            <label>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—á–µ—Ç–∞:</label>
            <div id="points-plot" style="max-width: 600px; width: 100%;"></div>
            <output id="result"></output>
        </div>
    </form>

    <script>
        function timeToSeconds(hours, minutes, seconds) {
            return (
                parseInt(hours || 0) * 3600 +
                parseInt(minutes || 0) * 60 +
                parseInt(seconds || 0)
            );
        }

        function calculate() {
            const eventType = document.getElementById('event-type').value;

            const time1Hours = document.getElementById('time1-hours').value;
            const time1Minutes = document.getElementById('time1-minutes').value;
            const time1Seconds = document.getElementById('time1-seconds').value;

            const time2Hours = document.getElementById('time2-hours').value;
            const time2Minutes = document.getElementById('time2-minutes').value;
            const time2Seconds = document.getElementById('time2-seconds').value;

            const seconds1 = timeToSeconds(time1Hours, time1Minutes, time1Seconds);
            const seconds2 = timeToSeconds(time2Hours, time2Minutes, time2Seconds);

            const resultElement = document.getElementById('result');

            if (seconds1 <= 0 || seconds2 <= 0) {
                // resultElement.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ —Å–≤–æ–µ.';
                // resultElement.style.color = 'red';
                // resetPlot()
                showErrorInPlot('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ —Å–≤–æ–µ.');
                return;
            }

            if (seconds2 < seconds1) {
                // resultElement.textContent = '–í–∞—à–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ –∏–ª–∏ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.';
                // resultElement.style.color = 'red';
                // resetPlot()
                showErrorInPlot('–í–∞—à–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ –∏–ª–∏ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.');
                return;
            }

            const base = {
                "–ò–Ω–¥–æ—Ä": 700,
                "–ê–∫–≤–∞—Ç–ª–æ–Ω": 700,
                "–ö—Ä–æ—Å—Å": 700,
                "–°–ø—Ä–∏–Ω—Ç": 700.0,
                "–î—É–∞—Ç–ª–æ–Ω": 700.0,
                "–û–ª–∏–º–ø–∏–π–∫–∞": 800.0,
                "–ü–æ–ª–æ–≤–∏–Ω–∫–∞": 900.0,
                "–ü–æ–ª–Ω–∞—è": 1000.0
            }[eventType]

            const result = base * Math.max(
                (1 - (seconds2 - seconds1) / 0.9 / seconds1),
                0
            );

            // resultElement.innerHTML =
            //     `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ${base} –æ—á–∫–æ–≤, <span style="font-weight: bold;">–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ${result.toFixed(2)} –æ—á–∫–æ–≤</span>`;
            // resultElement.style.color = '';

            drawPlot(seconds1, seconds2, base);
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);

            return [
                h > 0 ? String(h).padStart(2, '0') : null,
                String(m).padStart(2, '0'),
                String(s).padStart(2, '0')
            ].filter(Boolean).join(':');
        }

        function resetPlot() {
            Plotly.newPlot('points-plot', [], {
                xaxis: { visible: false },
                yaxis: { visible: false },
                annotations: [{
                    text: '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
                    x: 0.5,
                    y: 0.5,
                    xref: 'paper',
                    yref: 'paper',
                    showarrow: false,
                    font: { size: 12 }
                }]
            });
        }

        function showErrorInPlot(msg) {
            Plotly.newPlot('points-plot', [], {
                xaxis: { visible: false },
                yaxis: { visible: false },
                annotations: [{
                    text: msg,
                    x: 0.5,
                    y: 0.5,
                    xref: 'paper',
                    yref: 'paper',
                    showarrow: false,
                    font: { size: 12, color: 'red' }
                }]
            });
        }

        function drawPlot(seconds1, seconds2, base) {
            const x = [];
            const y = [];

            const maxTime = Math.max(seconds1 * 2, seconds2);
            const step = seconds1 / 120;

            for (let t = seconds1; t <= maxTime; t += step) {
                x.push(t);
                y.push(
                    base * Math.max(
                        1 - (t - seconds1) / (0.9 * seconds1),
                        0
                    )
                );
            }

            const curve = {
                x,
                y,
                mode: 'lines',
                name: '–§–æ—Ä–º—É–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤',
                hovertemplate:
                    '–í—Ä–µ–º—è: %{customdata}<br>' +
                    '–û—á–∫–∏: %{y:.2f}<extra></extra>',
                customdata: x.map(formatTime),
                line: { width: 3 }
            };

            const winnerPoint = {
                x: [seconds1],
                y: [base],
                mode: 'markers+text',
                name: '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å',
                marker: { size: 10 },
                hovertemplate:
                    '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å<br>' +
                    '–í—Ä–µ–º—è: %{customdata}<br>' +
                    '–û—á–∫–∏: %{y:.2f}<extra></extra>',
                customdata: [formatTime(seconds1)],
                text: [`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ${base} –æ—á–∫–æ–≤`],
                textposition: 'top right',
            };

            const participantPoints = base * Math.max(
                1 - (seconds2 - seconds1) / (0.9 * seconds1),
                0
            );

            const participantPoint = {
                x: [seconds2],
                y: [participantPoints],
                mode: 'markers+text',
                name: '–í—ã',
                marker: { size: 10 },
                hovertemplate:
                    '–í—ã<br>' +
                    '–í—Ä–µ–º—è: %{customdata}<br>' +
                    '–û—á–∫–∏: %{y:.2f}<extra></extra>',
                customdata: [formatTime(seconds2)],
                text: [`–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ${participantPoints.toFixed(2)} –æ—á–∫–æ–≤`],
                textposition: 'right',
            };

            const tickStep = (maxTime - seconds1) / 10;
            const tickvals = [];
            const ticktext = [];

            for (let t = seconds1; t <= maxTime; t += tickStep) {
                tickvals.push(t);
                ticktext.push(formatTime(t));
            }

            const layout = {
                xaxis: {
                    title: '–í—Ä–µ–º—è',
                    tickvals,
                    ticktext
                },
                yaxis: {
                    title: '–û—á–∫–∏',
                    rangemode: 'tozero',
                    dtick: 50
                },
                margin: {
                    t: 30,
                    r: 10,
                    l: 50
                },
                showlegend: false
            };

            Plotly.newPlot(
                'points-plot',
                [curve, winnerPoint, participantPoint],
                layout,
                { responsive: true }
            );
        }
    </script>

    <script>
        const predefinedTimes = {
            "–ò–Ω–¥–æ—Ä": "00:22:00",
            "–ê–∫–≤–∞—Ç–ª–æ–Ω": "00:35:00",
            "–ö—Ä–æ—Å—Å": "00:45:00",
            "–°–ø—Ä–∏–Ω—Ç": "00:50:00",
            "–î—É–∞—Ç–ª–æ–Ω": "00:55:00",
            "–û–ª–∏–º–ø–∏–π–∫–∞": "02:05:00",
            "–ü–æ–ª–æ–≤–∏–Ω–∫–∞": "04:10:00",
            "–ü–æ–ª–Ω–∞—è": "09:30:00"
        };

        document.getElementById('event-type').addEventListener('change', function () {
            const selectedEvent = this.value;
            const predefinedTime = predefinedTimes[selectedEvent];
            const [hours, minutes, seconds] = predefinedTime.split(':');
            document.getElementById('time1-hours').value = hours;
            document.getElementById('time1-minutes').value = minutes;
            document.getElementById('time1-seconds').value = seconds;

            document.getElementById('time2-hours').value = '';
            document.getElementById('time2-minutes').value = '';
            document.getElementById('time2-seconds').value = '';
            
            resetPlot();
        });

        const timeInputs = [
            'time1-hours', 'time1-minutes', 'time1-seconds',
            'time2-hours', 'time2-minutes', 'time2-seconds'
        ];
        timeInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', calculate);
        });

        resetPlot();
    </script>
</body>

</html>